{% comment %} First loop for non-testimonial blocks {% endcomment %}
{% for block in section.blocks %}
  {% if block.type != 'testimonial' %}
    {% case block.type %}
      {% when 'title' %}
        {% if block.settings.title != blank %}
          <h2 class="ai-testimonials-title-{{ section.id }}">
            {{ block.settings.title }}
          </h2>
        {% endif %}

      {% when 'description' %}
        {% if block.settings.description != blank %}
          <div class="ai-testimonials-description-{{ section.id }}">
            {{ block.settings.description | replace: block.settings.highlight_text, '<span class="highlight">' | append: block.settings.highlight_text | append: '</span>'}}
          </div>
        {% endif %}

      

{% comment %} Then the testimonial grid {% endcomment %}
<div class="ai-testimonial-grid-{{ section.id }}" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
  {% for block in section.blocks %}
    {% if block.type == 'testimonial' %}
      <div class="ai-testimonial-card-{{ section.id }}">
        {% if block.settings.quote != blank %}
          <div class="ai-testimonial-quote-{{ section.id }}">
            {{ block.settings.quote }}
          </div>
        {% endif %}

        <div class="ai-testimonial-footer-{{ section.id }}">
          <div class="ai-testimonial-icon-{{ section.id }}">
            {% if block.settings.icon %}
              <img src="{{ block.settings.icon | image_url: width: 50 }}" alt="Customer verification icon" loading="lazy">
            {% else %}
              <div class="ai-testimonial-icon-placeholder-{{ section.id }}">âœ…</div>
            {% endif %}
          </div>

          <div class="ai-testimonial-customer-{{ section.id }}">
            {% if block.settings.name or block.settings.age %}
              <div class="ai-testimonial-name-{{ section.id }}">
                {{ block.settings.name }}{% if block.settings.age != blank %}, {{ block.settings.age }}{% endif %}
              </div>
            {% endif %}
            <div class="ai-testimonial-verified-{{ section.id }}">
              {{ block.settings.verified_label | default: "Verified Customer" }}
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>
{% when 'cta' %}
        {% if block.settings.button_text != blank %}
          <div class="ai-testimonials-cta-{{ section.id }}">
            <a href="{{ block.settings.button_link }}" class="ai-testimonials-button-{{ section.id }}">
              {{ block.settings.button_text }}
            </a>
          </div>
        {% endif %}
    {% endcase %}
  {% endif %}
{% endfor %}